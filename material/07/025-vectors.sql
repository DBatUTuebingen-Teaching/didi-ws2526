-- DuckDB's encoding of vectors of complex values
-- combines the encoding schemes for structs and lists
--
-- Generate test data with DuckDB's builtin function test_vector_types()
-- (see https://duckdb.org/docs/stable/dev/sqllogictest/writing_tests)


-- (1) list of structs
--
SELECT DISTINCT t.x
FROM   test_vector_types(null :: struct(a int, b text)[]) t(x);

-- โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
-- โ                                    x                                     โ
-- โ                      struct(a integer, b varchar)[]                      โ
-- โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
-- โ [{'a': NULL, 'b': NULL}]                                                 โ
-- โ []                                                                       โ
-- โ [{'a': -2147483648, 'b': ๐ฆ๐ฆ๐ฆ๐ฆ๐ฆ๐ฆ}, {'a': 2147483647, 'b': goo\0se}] โ
-- โ [{'a': 3, 'b': ๐ฆ๐ฆ๐ฆ๐ฆ๐ฆ๐ฆ}, {'a': 5, 'b': goo\0se}]                    โ
-- โ [{'a': 7, 'b': NULL}]                                                    โ
-- โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

/*

  DuckDB vector encoding

        LIST                             STRUCT
                               (of a int, b text fields)

   โก(0,1)โค   โก1โค          โก      .    โคโก0โค   โก      .     โคโก0โค  โก1โค
   โข(1,0)โฅ   โข1โฅ          โข-2147483648โฅโข1โฅ   โข๐ฆ๐ฆ๐ฆ๐ฆ๐ฆ๐ฆโฅโข1โฅ  โข1โฅ
   โข(1,2)โฅ   โข1โฅ          โข 2147483647โฅโข1โฅ   โข     goo\0seโฅโข1โฅ  โข1โฅ
   โข(3,2)โฅ   โข1โฅ          โข          3โฅโข1โฅ   โข๐ฆ๐ฆ๐ฆ๐ฆ๐ฆ๐ฆโฅโข1โฅ  โข1โฅ
   โฃ(5,1)โฆ   โฃ1โฆ          โข          5โฅโข1โฅ   โข     goo\0seโฅโข1โฅ  โข1โฅ
     data    val          โฃ          7โฆโฃ1โฆ   โฃ      .     โฆโฃ0โฆ  โฃ1โฆ
     (offs,len)                  a     val          b      val  val

*/


-- (2) struct of lists
--
SELECT DISTINCT t.x
FROM   test_vector_types(null :: struct(a int[], b text[])) t(x);

-- โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
-- โ                               x                                โ
-- โ                struct(a integer[], b varchar[])                โ
-- โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
-- โ {'a': [3, 5], 'b': [๐ฆ๐ฆ๐ฆ๐ฆ๐ฆ๐ฆ, goo\0se]}                    โ
-- โ {'a': [], 'b': []}                                             โ
-- โ {'a': [-2147483648, 2147483647], 'b': [๐ฆ๐ฆ๐ฆ๐ฆ๐ฆ๐ฆ, goo\0se]} โ
-- โ {'a': [NULL], 'b': [NULL]}                                     โ
-- โ {'a': [7], 'b': [NULL]}                                        โ
-- โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ


/*

DuckDB vector encoding

          STRUCT                                  two LISTs
(of a int[], b text[] fields)

  โก(0,2)โคโก1โค  โก(0,2)โคโก1โค   โก1โค         โก          3โคโก1โค   โก๐ฆ๐ฆ๐ฆ๐ฆ๐ฆ๐ฆโคโก1โค
  โข(2,0)โฅโข1โฅ  โข(2,0)โฅโข1โฅ   โข1โฅ         โข          5โฅโข1โฅ   โข     goo\0seโฅโข1โฅ
  โข(2,2)โฅโข1โฅ  โข(2,2)โฅโข1โฅ   โข1โฅ         โข-2147483648โฅโข1โฅ   โข๐ฆ๐ฆ๐ฆ๐ฆ๐ฆ๐ฆโฅโข1โฅ
  โข(4,1)โฅโข1โฅ  โข(4,1)โฅโข1โฅ   โข1โฅ         โข 2147483647โฅโข1โฅ   โข     goo\0seโฅโข1โฅ
  โฃ(5,1)โฆโฃ1โฆ  โฃ(5,1)โฆโฃ1โฆ   โฃ1โฆ         โข      .    โฅโข0โฅ   โข      .     โฅโข0โฅ
     a   val     b   val   val         โฃ          7โฆโฃ1โฆ   โฃ      .     โฆโฃ0โฆ
                                            data    val        data     val
       (offs, len)
                                               a                   b

  NB. The two vectors encoding the lists in the a and b fields
  have the same length (of 6). This is only due to the sample value
  produced by test_vector_types().  In general, the vector lengths
  will differ.
*/


-----------------------------------------------------------------------
-- Unrelated:
-- DuckDB exposes more testing functionality, for example
-- function test_all_types().

.columns
FROM test_all_types();
.rows
